name: Testbuild website

env:
  HUGO_VERSION: 0.88.1

on:
  pull_request:
    branches:
      - master
    paths-ignore:
      - README.md
      - .gitignore

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source ğŸ›ï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Install hugo ğŸ“¦
        run: |
          wget https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_${HUGO_VERSION}_Linux-64bit.deb -O /tmp/hugo.dpkg
          sudo dpkg -i /tmp/hugo.dpkg

      - name: Build website ğŸ”§
        run: |
          hugo -v --cleanDestinationDir --baseURL="https://reaktor23.org/_test/${{github.event.number}}"

      - name: Deploy to gh-pages ğŸš€
        uses: JamesIves/github-pages-deploy-action@4.1.5
        with:
          branch: gh-pages
          folder: public/_test/${{github.event.number}}


      - name: Create comment with link to testbuild
        uses: actions/github-script@v5
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'Hi. A testbuild of the website with your PR is available at https://reaktor23.org/_test/${{github.event.number}}. Please have a look if everything works like intendet.'
            })
